# Description: Root filesystem package
# URL:         https://github.com/zeppe-lin

name=filesystem
version=3.6
release=1
source=(issue motd shells group passwd shadow securetty fstab
	mime.types)

build() {
    # Directory structure
    install -d $PKG/bin
    install -d $PKG/sbin
    install -d $PKG/boot
    install -d $PKG/dev
    install -d $PKG/dev/pts
    install -d $PKG/proc
    install -d $PKG/sys
    install -d $PKG/etc
    install -d $PKG/mnt
    install -d $PKG/run
    install -d $PKG/lib{,32}
    ln -s lib $PKG/lib64
    install -d $PKG/lib/modules
    install -d $PKG/opt
    install -d $PKG/opt/bin
    install -d $PKG/opt/sbin
    install -d $PKG/usr
    install -d $PKG/usr/{bin,include,lib{,32},sbin,share,src}
    ln -s lib $PKG/usr/lib64
    install -d -p $PKG/usr/share/man/man{1,2,3,4,5,6,7,8}
    ln -s ../var $PKG/usr/var
    install -d $PKG/var
    install -d $PKG/var/cache
    install -d $PKG/var/lib
    install -d $PKG/var/lib/pkg
    install -d $PKG/var/log
    install -d $PKG/var/log/old
    install -d $PKG/var/run
    touch $PKG/var/run/utmp
    install -d $PKG/var/spool
    install -d $PKG/var/ftp
    install -d $PKG/var/www
    install -d $PKG/var/empty
    ln -s spool/mail $PKG/var/mail
    install -d $PKG/home

    install -m 1777 -d $PKG/tmp
    install -m 0750 -d $PKG/root
    install -m 1777 -d $PKG/var/lock
    install -m 1777 -d $PKG/var/spool/mail
    install -m 1777 -d $PKG/var/tmp
    install -m 1777 -d $PKG/dev/shm

    # /dev
    mknod $PKG/dev/console c 5 1
    chmod 0600 $PKG/dev/console

    # /etc
    install -m 0644 issue $PKG/etc
    install -m 0644 motd $PKG/etc
    install -m 0644 shells $PKG/etc
    install -m 0644 group $PKG/etc
    install -m 0644 passwd $PKG/etc
    install -m 0640 shadow $PKG/etc
    install -m 0644 securetty $PKG/etc
    install -m 0644 fstab $PKG/etc
    install -m 0644 mime.types $PKG/etc
    ln -s /proc/self/mounts $PKG/etc/mtab
}
